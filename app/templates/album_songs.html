{% extends 'base.html' %}
{% set show_navbar = false %}

{% block title %}{{ album.album_title }} Songs{% endblock %}

{% block extra_links %}
<link rel="stylesheet" href="/static/songs.css"/>
{% endblock %}

{% block content %}
    <h1>{{ album.album_title }} Songs</h1>    
    <div class="songs-content">   
        {% with messages = get_flashed_messages() %}
        {% if messages %}
            {% for message in messages %}
                <p>{{ message }}</p>
            {% endfor %}
        {% endif %}
        {% endwith %}

        <ul>
            {% for song in album.songs %}
                <li>
                    <a href="#" class="song-link" 
                       data-src="{{ url_for('static', filename='audio/' + album.artist_id|string + '/' + album.album_title.replace(' ', '_').lower() + '/' + song.song_title + '.mp3') }}" 
                       data-title="{{ song.song_title }}" 
                       data-artist="{{ song.album.artist.artist_stagename }}">
                       {{ song.song_title }}
                    </a>
                    
                </li>
            {% endfor %}
        </ul>
    </div>

    <div class="player-container hidden">
        <div class="player">
            <div id="song-info" class="hidden">
                <p id="song-title"></p>
                <p id="artist-name"></p>
            </div>
            <button id="info-button" onclick="toggleSongInfo()">Show Info</button>
            <audio id="player" controls autoplay>
                <source src="" type="audio/mpeg">
            </audio>
        </div>
    </div>

    <script>
        function toggleSongInfo() {
            var songInfo = document.getElementById("song-info");
            var infoButton = document.getElementById("info-button");
            
            if (songInfo.classList.contains("hidden")) {
                songInfo.classList.remove("hidden");
                infoButton.textContent = "Hide Info";
            } else {
                songInfo.classList.add("hidden");
                infoButton.textContent = "Show Info";
            }
        }

        // Get all song links
        var songLinks = document.getElementsByClassName("song-link");

        // Add click event listener to each song link
        for(var i = 0; i < songLinks.length; i++) {
            songLinks[i].addEventListener("click", function(event) {
                // Prevent the default action (which would be to follow the link)
                event.preventDefault();

                // Get the player and source element
                var player = document.getElementById("player");
                var source = player.getElementsByTagName("source")[0];

                // Update the source element with the new song URL
                source.src = this.dataset.src;

                // Update song info
                document.getElementById("song-title").innerText = this.dataset.title;
                document.getElementById("artist-name").innerText = this.dataset.artist;

                // Load the new song into the player
                player.load();

                // Show the player
                document.getElementsByClassName("player-container")[0].classList.remove("hidden");

                // Autoplay the song
                player.play();
            });
        }
    </script>
{% endblock %}
